name: Deploy-React-app-to-github-pages
on:
    push:
         branches:
             - main
             - 'feature/**'
         paths-ignore: 
             - '.github/workflows/*'    
             - README.md
    workflow_dispatch:        
jobs:
     test:
            runs-on: ubuntu-latest
            steps: 
               - name: Get Code
                 uses: actions/checkout@v4

              
               - name: Install node js 
                 uses: actions/setup-node@v4
                 with:
                   node-version: 20

               - name: Cache Dependency
                 uses: actions/cache@v4
                 with: 
                   path: ~/.npm  
                   key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}

               - name: Install dependencies
                 run : npm ci

               - name: run Tests
                 run: npm run test 
                 
     build:
            needs: test 
            runs-on: ubuntu-latest 
            steps: 

               - name: Get Code
                 uses: actions/checkout@v4

               - name: Install node js 
                 uses: actions/setup-node@v4
                 with:
                   node-version: 20
                            
               - name: Cache Dependency
                 uses: actions/cache@v4
                 with: 
                   path: ~/.npm  
                   key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }} 

               - name: Install dependencies
                 run : npm ci

               - name: building Project
                 run: npm run build     
               - name: Upload dist Artifact
                 uses: actions/upload-pages-artifact@v3    
                 with:
                      name: github-pages
                      path: dist

     deploy:  
             needs: build
             runs-on: ubuntu-latest
                # Grant GITHUB_TOKEN the permissions required to make a Pages deployment
             permissions:
                pages: write      # to deploy to Pages
                id-token: write 
                 # Deploy to the github-pages environment
             environment:
                 name: github-pages
                 url: ${{ steps.deployment.outputs.page_url }}

             steps:
               - name: Deploy to GitHub Pages
                 id: deployment
                 uses: actions/deploy-pages@v4 # or specific "vX.X.X" version tag for this action
                 with:
                      token: ${{secrets.GITHUB_TOKEN}}