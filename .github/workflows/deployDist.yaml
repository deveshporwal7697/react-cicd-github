name: Deploy-Dist
# on: [ push , workflow_dispatch] 
on:
    push:
         branches:
             - main
             - 'feature/**'
         paths-ignore: 
             - '.github/workflows/*'    
             - README.md
    workflow_dispatch:        
jobs:
     test:
            runs-on: ubuntu-latest
            steps: 
               - name: Get Code
                #  run : |
                #    echo "Cloning repo .."
                #    echo "${{toJson(github)}}"
                #    git clone  https://github.com/${{github.repository}}.git
                 uses: actions/checkout@v4

              
               - name: Install node js 
                 uses: actions/setup-node@v4
                 with:
                   node-version: 20

               - name: Cache Dependency
                 uses: actions/cache@v4
                 with: 
                   path: ~/.npm  
                   key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}

               - name: print node version
                 run: node -v
                 
               - name: Install dependencies
                 run : npm ci

               - name: run Tests
                 run: npm run test 
                 
     build:
            needs: test 
            runs-on: ubuntu-latest 
            steps: 
               - name: Get Code
                 uses: actions/checkout@v4

               - name: Install node js 
                 uses: actions/setup-node@v4
                 with:
                   node-version: 20
                            
               - name: Cache Dependency
                 uses: actions/cache@v4
                 with: 
                   path: ~/.npm  
                   key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }} 

               - name: Install dependencies
                 run : npm ci

               - name: building Project
                 run: npm run build     
               - name: Upload dist Artifact
                 uses: actions/upload-artifact@v4  
                 with:
                      name: dist-file
                      path: dist
     deploy:
            needs: build 
            runs-on: ubuntu-latest    
            steps: 
               - name: Download Dist Artifact
                 uses: actions/download-artifact@v4  
                 with:
                      name: dist-file
                      path: dist
               - name: building Project
                 run: echo "deplyed successfully"